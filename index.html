<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙˆØ±ÙˆØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÛŒØ²ÛŒ (Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§ÙˆØ±)</title>
    <style>
        /* ØªØ¹Ø±ÛŒÙ ÙÙˆÙ†Øª Dubai */
        @font-face {
            font-family: 'Dubai';
            src: local('Dubai'), local('Dubai-Regular'), local('Dubai Medium'); 
        }

        /* CSS Ø§ØµÙ„ÛŒ */
        body {
            font-family: 'Dubai', Tahoma, sans-serif;
            margin: 20px;
            background-color: #f7faff; 
            color: #333;
        }
        
        input, select, button, textarea {
            font-family: 'Dubai', Tahoma, sans-serif;
        }

        .container {
            max-width: 1200px;
            margin: 30px auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 86, 179, 0.1); 
            border: 1px solid #e0e6f0; 
        }
        h1#main-title {
            color: #0056b3;
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 3px solid #0056b3;
            padding-bottom: 15px;
        }
        h2 {
            color: #337ab7;
            border-bottom: 2px solid #337ab720; 
            padding-bottom: 5px;
            margin-top: 25px;
        }
        label {
            display: block;
            margin-top: 10px;
            margin-bottom: 5px;
            font-weight: bold;
            color: #0056b3;
        }
        input[type="text"], input[type="number"], select, input[type="date"], textarea {
            width: 98%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            transition: border-color 0.3s, box-shadow 0.3s; 
        }
        input:focus, select:focus, textarea:focus {
            border-color: #0056b3;
            outline: none;
            box-shadow: 0 0 8px rgba(0, 86, 179, 0.2); 
        }
        
        .name-fields-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .name-fields-container > div {
            flex: 1;
            min-width: 200px;
        }

        /* Ø§Ø³ØªØ§ÛŒÙ„ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ */
        .add-btn, .submit-btn {
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        .add-btn {
            background-color: #28a745;
            color: white;
            margin-top: 15px;
        }
        .add-btn:hover { background-color: #218838; transform: translateY(-2px); }


        button.submit-btn {
            background-color: #007bff;
            color: white;
            padding: 15px 25px;
            font-size: 1.2rem;
            margin-top: 30px;
            width: 100%;
            box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        }
        button.submit-btn:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }
        
        /* Ú©Ù†ØªØ±Ù„â€ŒÙ‡Ø§ÛŒ ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø±Ø³ */
        #subjectsContainer {
            border: 1px solid #e0e6f0; 
            padding: 15px;
            border-radius: 10px;
            background-color: #f5faff;
        }
        .subject-entry {
            border: 1px solid #bbdefb;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #ffffff;
            position: relative;
        }
        .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8rem;
            position: absolute;
            left: 10px;
            top: 10px;
            transition: background-color: 0.3s;
        }
        .remove-btn:hover { background-color: #c82333; }
        
        .exam-fields {
            padding: 15px;
            border: 1px dashed #0056b3;
            border-radius: 10px;
            margin-top: 15px;
            background-color: #f0f8ff;
        }
        .exam-fields h3 {
            margin-top: 0;
            color: #0056b3;
        }

        /* Ø¨Ø®Ø´ ÙÛŒÙ„Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø´Ø§ÙˆØ± */
        #consultantNotesSection {
            background-color: #f0f8ff;
            border: 1px solid #bbdefb;
            padding: 20px;
            border-radius: 12px;
            margin-top: 25px;
        }
        #consultantNotesSection h2 {
            margin-top: 0;
            color: #0056b3;
        }
        #consultantNotes {
            height: 120px;
            width: 98%; /* ØªØ·Ø§Ø¨Ù‚ Ø¨Ø§ Ø¨Ù‚ÛŒÙ‡ */
        }

        /* Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ¨Ø§ÛŒÙ„ */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
        }
    </style>
</head>
<body>

<div class="container">
    <h1 id="main-title">âœ¨ ÙˆØ±ÙˆØ¯ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÛŒØ²ÛŒ (Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§ÙˆØ±) âœ¨</h1>

    <form id="inputForm" action="https://formspree.io/f/xovpgojr" method="POST">
        
        <h2>Û±. ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡</h2>
        
        <div class="name-fields-container">
            <div>
                <label for="studentName">Ù†Ø§Ù… Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²:</label>
                <input type="text" id="studentName" name="studentName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²">
            </div>
            <div>
                <label for="consultantName">Ù†Ø§Ù… Ù…Ø´Ø§ÙˆØ±:</label>
                <input type="text" id="consultantName" name="consultantName" placeholder="Ù†Ø§Ù… Ùˆ Ù†Ø§Ù… Ø®Ø§Ù†ÙˆØ§Ø¯Ú¯ÛŒ Ù…Ø´Ø§ÙˆØ±">
            </div>
        </div>

        <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 15px;">
            <div style="flex: 1; min-width: 200px;">
                <label for="educationBase">Ù¾Ø§ÛŒÙ‡ ØªØ­ØµÛŒÙ„ÛŒ:</label>
                <select id="educationBase" onchange="updateDefaultBase()">
                    <option value="12">Ø¯ÙˆØ§Ø²Ø¯Ù‡Ù… (Ù¾ÛŒØ´â€ŒÙØ±Ø¶)</option>
                    <option value="11">ÛŒØ§Ø²Ø¯Ù‡Ù…</option>
                    <option value="10">Ø¯Ù‡Ù…</option>
                </select>
            </div>
            <div style="flex: 1; min-width: 200px;">
                <label for="numWeeks">ØªØ¹Ø¯Ø§Ø¯ Ù‡ÙØªÙ‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ:</label>
                <input type="number" id="numWeeks" value="4" min="1" max="52" onchange="createExamFields()">
            </div>
            <div style="flex: 1; min-width: 200px;">
                <label for="startDate">ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ (Ø§ÙˆÙ„ÛŒÙ† Ø´Ù†Ø¨Ù‡):</label>
                <input type="date" id="startDate" name="startDate">
            </div>
            <div style="flex: 1; min-width: 200px;">
                <label for="testsPerPartGlobal">ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øª Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¯Ø± Ù‡Ø± Ù¾Ø§Ø±Øª:</label>
                <input type="number" id="testsPerPartGlobal" value="40" min="10">
            </div>
        </div>

        <h3>Û±.Û±. Ù…Ø¯ÛŒØ±ÛŒØª Ø²Ù…Ø§Ù†: (ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Û¹Û° Ø¯Ù‚ÛŒÙ‚Ù‡â€ŒØ§ÛŒ Ø¯Ø± Ù‡Ø± Ø±ÙˆØ²)</h3>
        <div id="dayPartsContainer" style="display: flex; flex-wrap: wrap; gap: 10px;">
            </div>
        
        <div class="exam-fields" id="examFieldsContainer">
            </div>

        <h2>Û². ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø¯Ø±ÙˆØ³ (Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ Ùˆ Ù…Ù†Ø§Ø¨Ø¹):</h2>
        <div id="subjectsContainer">
            </div>
        
        <div style="display: flex; gap: 10px; margin-top: 15px;">
            <button type="button" class="add-btn" onclick="addSubjectEntry()">+ Ø§ÙØ²ÙˆØ¯Ù† Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯</button>
        </div>
        
        <div id="consultantNotesSection">
            <h2>Û³. Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ùˆ ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø´Ø§ÙˆØ±</h2>
            <p>
                Ù‡Ø±Ú¯ÙˆÙ†Ù‡ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÛŒØŒ Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ Ø®Ø§ØµØŒ Ù†Ù‚Ø§Ø· Ø¶Ø¹Ù ÛŒØ§ Ù‚ÙˆØª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ØŒ ÛŒØ§ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„â€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒ Ú©Ù‡ Ø¯Ø± ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ø¨Ø§Ù„Ø§ Ø¬Ø§ Ù†Ø´Ø¯Ù‡â€ŒØ§Ù†Ø¯ Ø±Ø§ Ø¯Ø± Ø§ÛŒÙ† Ù‚Ø³Ù…Øª ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯.
            </p>
            <textarea id="consultantNotes" name="consultantNotes" placeholder="Ù…Ø«Ø§Ù„: ØªÙ…Ø±Ú©Ø² ÙˆÛŒÚ˜Ù‡ Ø±ÙˆÛŒ Ø¯Ø±ÙˆØ³ ØªØ®ØµØµÛŒ Ø¯Ø± Ø¯Ùˆ Ù‡ÙØªÙ‡ Ø§ÙˆÙ„..."></textarea>
        </div>

        <input type="hidden" id="hiddenJsonData" name="1_JSON_Data">
        <input type="hidden" id="hiddenFullPrompt" name="2_Full_Prompt_For_AI">

        <button type="submit" class="submit-btn" onclick="return prepareForSubmit()">
            ğŸš€ Ø§Ø±Ø³Ø§Ù„ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø±Ø§ÛŒ Ù…Ø´Ø§ÙˆØ± (Ø§ÛŒÙ…ÛŒÙ„)
        </button>
    </form>
    
</div>


<script>
    let subjectCount = 0;
    const dayNames = ["Ø´Ù†Ø¨Ù‡", "ÛŒÚ©Ø´Ù†Ø¨Ù‡", "Ø¯ÙˆØ´Ù†Ø¨Ù‡", "Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡", "Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡", "Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡", "Ø¬Ù…Ø¹Ù‡"];
    
    const defaultSubjects = [
        { name: "Ø²ÛŒØ³Øª Ø´Ù†Ø§Ø³ÛŒ", topicName: "Ù…Ø¨Ø­Ø« Û±", base: "12", tests: 150, learnParts: 6, source: "Ú©ØªØ§Ø¨ Ø¯Ø±Ø³ÛŒ + ØªØ³Øª", classDays: [], classPartCount: 0, forcedDays: [] },
        { name: "ÙÛŒØ²ÛŒÚ©", topicName: "Ù…Ø¨Ø­Ø« Û±", base: "12", tests: 120, learnParts: 4, source: "Ú©ØªØ§Ø¨ Ø¯Ø±Ø³ÛŒ + ØªØ³Øª", classDays: [], classPartCount: 0, forcedDays: [] }
    ];

    const isSchoolDay = (dayIndex) => dayIndex >= 0 && dayIndex <= 4; 

    
    // â­ï¸â­ï¸â­ï¸ ØªØ§Ø¨Ø¹ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ù‚Ø¨Ù„ Ø§Ø² Ø§Ø±Ø³Ø§Ù„ â­ï¸â­ï¸â­ï¸
    function prepareForSubmit() {
        try {
            const allSettings = getAllSettings();
            
            // Û±. Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ JSON
            const jsonData = JSON.stringify(allSettings, null, 4); // null, 4 Ø¨Ø±Ø§ÛŒ Ø²ÛŒØ¨Ø§Ø³Ø§Ø²ÛŒ
            
            // Û². Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ù¾Ø±Ø§Ù…Ù¾Øª (Ù¾Ø±Ø§Ù…Ù¾Øª Ø¬Ø§Ø¯ÙˆÛŒÛŒ Ø´Ù…Ø§)
            const studentName = allSettings.general.studentName || "Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²";
            const promptContent = `
Ø´Ù…Ø§ ÛŒÚ© Ù…Ø´Ø§ÙˆØ± Ø§Ø±Ø´Ø¯ Ú©Ù†Ú©ÙˆØ± Ø§ÛŒØ±Ø§Ù† Ø¨Ø§ ØªØ®ØµØµ Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡â€ŒØ±ÛŒØ²ÛŒ Ø¯Ø±Ø³ÛŒ Ø¨Ù‡ Ø±ÙˆØ´ "Ù…ÙˆØ¬ÛŒ" (Interleaved Practice) Ù‡Ø³ØªÛŒØ¯.
ÙˆØ¸ÛŒÙÙ‡ Ø´Ù…Ø§ Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ù…Ù„ Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ø¨Ù‡ ØµÙˆØ±Øª ÛŒÚ© Ø¢Ø¨Ø¬Ú©Øª JSON Ùˆ ØªØ¨Ø¯ÛŒÙ„ Ø¢Ù† Ø¨Ù‡ ÛŒÚ© Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ Ø¯Ù‚ÛŒÙ‚ Ùˆ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø§Ø³Øª.

**Ø§Ø·Ù„Ø§Ø¹Ø§Øª ÙˆØ±ÙˆØ¯ÛŒ Ø¯Ø§Ù†Ø´â€ŒØ¢MÙˆØ²:**
\`\`\`json
${jsonData}
\`\`\`

**Ù‚ÙˆØ§Ù†ÛŒÙ† Ùˆ Ø¯Ø³ØªÙˆØ±Ø§Ù„Ø¹Ù…Ù„â€ŒÙ‡Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÛŒØ²ÛŒ:**

1.  **Ù‡Ø¯Ù:** Ø§ÛŒØ¬Ø§Ø¯ ÛŒÚ© Ø¨Ø±Ù†Ø§Ù…Ù‡ ${allSettings.general.numWeeks} Ù‡ÙØªÙ‡â€ŒØ§ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® Ø´Ø±ÙˆØ¹ ${allSettings.general.startDate}.
2.  **Ø³Ø§Ø®ØªØ§Ø± Ø®Ø±ÙˆØ¬ÛŒ:** Ø®Ø±ÙˆØ¬ÛŒ Ø¨Ø§ÛŒØ¯ ÛŒÚ© Ø¬Ø¯ÙˆÙ„ Markdown Ú©Ø§Ù…Ù„ Ø¨Ø§Ø´Ø¯. Ù‡Ø± Ù‡ÙØªÙ‡ ÛŒÚ© Ø¬Ø¯ÙˆÙ„ Ø¬Ø¯Ø§Ú¯Ø§Ù†Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯. Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ Ø´Ø§Ù…Ù„: Â«Ø±ÙˆØ²Â»ØŒ Â«Ù†ÙˆØ¹ Ù¾Ø§Ø±ØªÂ» (Ø¢Ù…ÙˆØ²Ø´ÛŒØŒ ØªØ³ØªØŒ Ù…Ø±ÙˆØ±ØŒ Ú©Ù„Ø§Ø³ØŒ ...)ØŒ Â«Ø¯Ø±Ø³ - Ù…Ø¨Ø­Ø«Â»ØŒ Â«Ù…Ù†Ø¨Ø¹/Ø¬Ø²Ø¦ÛŒØ§ØªÂ».
3.  **Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù…ÙˆØ¬ÛŒ (Wave Algorithm):**
    * **ÙØ§Ø² Û± (ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ):** Û¶Û°Ùª Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ (LearnParts) Ùˆ Û´Û°Ùª Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØ³Øª (TestParts) Ø¨Ø§ÛŒØ¯ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ ØªÙˆØ²ÛŒØ¹ Ø´ÙˆÙ†Ø¯.
    * **ÙØ§Ø² Û² (ØªØ«Ø¨ÛŒØª):** Û´Û°Ùª Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ Ùˆ Û¶Û°Ùª Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ ØªØ³Øª Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù† ØªÙˆØ²ÛŒØ¹ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.
    * **ØªÙ†ÙˆØ¹ (Interleaving):** Ù‡Ø±Ú¯Ø² Ø¯Ùˆ Ù¾Ø§Ø±Øª Ø§Ø² ÛŒÚ© Ø¯Ø±Ø³ (Ù…Ø«Ù„Ø§Ù‹ Ø¯Ùˆ Ù¾Ø§Ø±Øª Ø´ÛŒÙ…ÛŒ) Ø±Ø§ Ù¾Ø´Øª Ø³Ø± Ù‡Ù… Ø¯Ø± ÛŒÚ© Ø±ÙˆØ² Ù‚Ø±Ø§Ø± Ù†Ø¯Ù‡ÛŒØ¯ØŒ Ù…Ú¯Ø± Ø§ÛŒÙ†Ú©Ù‡ ÛŒÚ©ÛŒ Ú©Ù„Ø§Ø³ Ø¨Ø§Ø´Ø¯ Ùˆ Ø¯ÛŒÚ¯Ø±ÛŒ Ù…Ø·Ø§Ù„Ø¹Ù‡.
    * **Ù†Ø³Ø¨Øª Ø±ÙˆØ²Ø§Ù†Ù‡:** Ø¯Ø± Ù‡Ø± Ø±ÙˆØ²ØŒ Ø³Ø¹ÛŒ Ú©Ù†ÛŒØ¯ Ù†Ø³Ø¨Øª Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ø¨Ù‡ ØªØ³ØªÛŒ Û² Ø¨Ù‡ Û± Ø¨Ø§Ø´Ø¯ (Ù…Ø«Ù„Ø§Ù‹ Û² Ø¢Ù…ÙˆØ²Ø´ØŒ Û± ØªØ³Øª).
4.  **Ø§ÙˆÙ„ÙˆÛŒØªâ€ŒØ¨Ù†Ø¯ÛŒ (Ø¨Ø³ÛŒØ§Ø± Ù…Ù‡Ù…):**
    * **Ø§ÙˆÙ„ÙˆÛŒØª Û± (Ø§Ø¬Ø¨Ø§Ø±ÛŒâ€ŒÙ‡Ø§):** Ø§Ø¨ØªØ¯Ø§ Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Â«Ø¢Ø²Ù…ÙˆÙ†Â» (examDays)ØŒ Â«Ù…Ø±ÙˆØ±Â» (reviewDays) Ùˆ Â«Ú©Ù„Ø§Ø³Â» (classDays) Ø±Ø§ Ø¯Ø± Ø±ÙˆØ²Ù‡Ø§ÛŒ Ù…Ø´Ø®Øµ Ø´Ø¯Ù‡ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.
    * **Ø§ÙˆÙ„ÙˆÛŒØª Û² (Ø¯Ø±ÙˆØ³ Ø§Ø¬Ø¨Ø§Ø±ÛŒ):** Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ \`forcedDays\` Ø¨Ø±Ø§ÛŒ Ù‡Ø± Ø¯Ø±Ø³ Ø±Ø§ Ø¯Ø± Ø±ÙˆØ²Ù‡Ø§ÛŒ ØªØ¹ÛŒÛŒÙ† Ø´Ø¯Ù‡ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.
    * **Ø§ÙˆÙ„ÙˆÛŒØª Û³ (Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù…ÙˆØ¬ÛŒ):** Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ù‚ÛŒÙ…Ø§Ù†Ø¯Ù‡ Ø±Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø§Ù„Ú¯ÙˆØ±ÛŒØªÙ… Ù…ÙˆØ¬ÛŒ Ø¯Ø± Ø§Ø³Ù„Ø§Øªâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ ØªÙˆØ²ÛŒØ¹ Ú©Ù†ÛŒØ¯.
5.  **Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ø´Ø§ÙˆØ±:** (Ø¨Ø³ÛŒØ§Ø± Ù…Ù‡Ù…! Ø­ØªÙ…Ø§Ù‹ Ø¯Ø± Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù„Ø­Ø§Ø¸ Ø´ÙˆØ¯)
    * "${allSettings.general.consultantNotes}"
6.  **Ø§Ø³Ù„Ø§Øªâ€ŒÙ‡Ø§ÛŒ Ø®Ø§Ù„ÛŒ (Manual Fill):** Ø§Ú¯Ø± Ø¯Ø± Ø±ÙˆØ²ÛŒ Ø§Ø³Ù„Ø§Øª Ø®Ø§Ù„ÛŒ Ø¨Ø§Ù‚ÛŒ Ù…Ø§Ù†Ø¯ØŒ Ø¢Ù† Ø±Ø§ Ø¨Ø§ Ø¹Ù†ÙˆØ§Ù† Â«Ø¬Ø¨Ø±Ø§Ù†ÛŒ / Ø¯Ø³ØªÛŒÂ» Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯.
7.  **ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øª:** Ù‡Ø± Ù¾Ø§Ø±Øª ØªØ³Øªâ€ŒØ²Ù†ÛŒ Ù…Ø¹Ø§Ø¯Ù„ ${allSettings.general.testsPerPart} ØªØ³Øª Ø§Ø³Øª.

**Ø´Ø±ÙˆØ¹ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ø±ÛŒØ²ÛŒ:**
Ù„Ø·ÙØ§Ù‹ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡ÙØªÚ¯ÛŒ Ø¯Ù‚ÛŒÙ‚ ${studentName} Ø±Ø§ Ø¨Ø±Ø§ÛŒ ${allSettings.general.numWeeks} Ù‡ÙØªÙ‡ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªÙ…Ø§Ù…ÛŒ Ù‚ÙˆØ§Ù†ÛŒÙ† ÙÙˆÙ‚ ØªÙˆÙ„ÛŒØ¯ Ú©Ù†ÛŒØ¯.
`;
            
            // Û³. Ù‚Ø±Ø§Ø± Ø¯Ø§Ø¯Ù† Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ Ø¯Ø± ÙÛŒÙ„Ø¯Ù‡Ø§ÛŒ Ù…Ø®ÙÛŒ
            document.getElementById('hiddenJsonData').value = jsonData;
            document.getElementById('hiddenFullPrompt').value = promptContent;
            
            // Ø§Ø¬Ø§Ø²Ù‡ Ø¨Ø¯Ù‡ ÙØ±Ù… Ø§Ø±Ø³Ø§Ù„ Ø´ÙˆØ¯
            return true; 
            
        } catch (error) {
            console.error("Ø®Ø·Ø§ Ø¯Ø± Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ ÙØ±Ù…:", error);
            alert("Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø® Ø¯Ø§Ø¯. Ù„Ø·ÙØ§Ù‹ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.");
            return false; // Ø¬Ù„ÙˆÛŒ Ø§Ø±Ø³Ø§Ù„ ÙØ±Ù… Ø±Ø§ Ø¨Ú¯ÛŒØ±
        }
    }


    // --- ØªÙˆØ§Ø¨Ø¹ Ú©Ù…Ú©ÛŒ ØªØ§Ø±ÛŒØ® Ùˆ Ø²Ù…Ø§Ù† (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) ---
    function formatDate(date) {
        return new Intl.DateTimeFormat('fa-IR', { year: 'numeric', month: 'numeric', day: 'numeric' }).format(date);
    }
    function addDays(date, days) {
        const result = new Date(date);
        result.setDate(date.getDate() + days);
        return result;
    }

    // --- ØªÙˆØ§Ø¨Ø¹ Ù…Ø¯ÛŒØ±ÛŒØª ÙØ±Ù… (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) ---
    function addSubjectEntry(defaultData = {}) {
        const container = document.getElementById('subjectsContainer');
        const index = subjectCount++; 
        
        const name = defaultData.name || `Ø¯Ø±Ø³ Ø¬Ø¯ÛŒØ¯ ${index + 1}`;
        const topicName = defaultData.topicName || '';
        const base = defaultData.base || document.getElementById('educationBase').value;
        const tests = defaultData.tests || 100;
        const learnParts = defaultData.learnParts || 5; 
        const source = defaultData.source || "Ù…Ù†Ø¨Ø¹ Ù…Ø·Ø§Ù„Ø¹Ù‡/ØªØ³Øª";
        const classDays = defaultData.classDays || [];
        const classPartCount = defaultData.classPartCount || 0;
        const forcedDays = defaultData.forcedDays || [];

        const classDayCheckboxes = dayNames.map((day, dIndex) => `
            <div style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="classDay_${index}_${dIndex}" value="${day}" 
                       ${classDays.includes(day) ? 'checked' : ''}>
                <label for="classDay_${index}_${dIndex}" style="margin: 0; font-weight: normal;">${day}</label>
            </div>
        `).join('');

        const forcedDayCheckboxes = dayNames.map((day, dIndex) => `
            <div style="display: flex; align-items: center; gap: 5px;">
                <input type="checkbox" id="forcedDay_${index}_${dIndex}" value="${day}" 
                       ${forcedDays.includes(day) ? 'checked' : ''}>
                <label for="forcedDay_${index}_${dIndex}" style="margin: 0; font-weight: normal;">${day}</label>
            </div>
        `).join('');

        const html = `
            <div class="subject-entry" id="subject_${index}">
                <button type="button" class="remove-btn" onclick="removeSubjectEntry(${index})">Ø­Ø°Ù</button>
                
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 2;">
                        <label for="name_${index}">Ù†Ø§Ù… Ø¯Ø±Ø³:</label>
                        <input type="text" id="name_${index}" value="${name}" placeholder="Ù…Ø«Ø§Ù„: Ø´ÛŒÙ…ÛŒ">
                    </div>
                    <div style="flex: 2;">
                        <label for="topicName_${index}">Ù†Ø§Ù… Ù…Ø¨Ø­Ø«:</label>
                        <input type="text" id="topicName_${index}" value="${topicName}" placeholder="Ù…Ø«Ø§Ù„: ÙØµÙ„ Û² ÛŒØ§ Ø³ÛŒÙ†ØªÛŒÚ©">
                    </div>
                    <div style="flex: 1;">
                        <label for="base_${index}">Ù¾Ø§ÛŒÙ‡:</label>
                        <select id="base_${index}">
                            <option value="12" ${base === '12' ? 'selected' : ''}>Ø¯ÙˆØ§Ø²Ø¯Ù‡Ù…</option>
                            <option value="11" ${base === '11' ? 'selected' : ''}>ÛŒØ§Ø²Ø¯Ù‡Ù…</option>
                            <option value="10" ${base === '10' ? 'selected' : ''}>Ø¯Ù‡Ù…</option>
                        </select>
                    </div>
                </div>
                <div style="display: flex; gap: 20px;">
                    <div style="flex: 1;">
                        <label for="tests_${index}">ØªØ¹Ø¯Ø§Ø¯ ØªØ³Øª/Ù…Ø³Ø¦Ù„Ù‡â€ŒØ§ÛŒ Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø²Ø¯Ù‡ Ø´ÙˆØ¯ (Ú©Ù„ Ø¯ÙˆØ±Ù‡):</label>
                        <input type="number" id="tests_${index}" value="${tests}" min="0">
                    </div>
                    <div style="flex: 1;">
                        <label for="learnParts_${index}">**ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ø¢Ù…ÙˆØ²Ø´ÛŒ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² (Ú©Ù„ Ø¯ÙˆØ±Ù‡):**</label>
                        <input type="number" id="learnParts_${index}" value="${learnParts}" min="0" step="1">
                    </div>
                </div>
                <label for="source_${index}">Ù…Ù†Ø¨Ø¹/Ù…Ø±Ø¬Ø¹ Ú©Ø§Ø±:</label>
                <input type="text" id="source_${index}" value="${source}" placeholder="Ù…Ø«Ø§Ù„: Ú©ØªØ§Ø¨ Ø¯Ø±Ø³ÛŒ + ØªØ³Øª Ú¯Ø§Ø¬">
                <div style="display: flex; gap: 20px; margin-top: 15px;">
                    <div style="flex: 2;">
                        <label>Ø±ÙˆØ²Ù‡Ø§ÛŒ Ø§Ø¬Ø¨Ø§Ø±ÛŒ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            ${forcedDayCheckboxes}
                        </div>
                    </div>
                    <div style="flex: 2;">
                        <label>Ø±ÙˆØ²Ù‡Ø§ÛŒ Ú©Ù„Ø§Ø³:</label>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                            ${classDayCheckboxes}
                        </div>
                        <label for="classPartCount_${index}" style="margin-top: 5px;">ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø§Ø±Øª Ú©Ù„Ø§Ø³ (Û¹Û° Ø¯Ù‚ÛŒÙ‚Ù‡â€ŒØ§ÛŒ):</label>
                        <input type="number" id="classPartCount_${index}" value="${classPartCount}" min="0">
                    </div>
                </div>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', html);
    }

    function removeSubjectEntry(index) {
        const entry = document.getElementById(`subject_${index}`);
        if (entry) {
            entry.remove();
        }
    }

    function updateDefaultBase() {
        const newBase = document.getElementById('educationBase').value;
        document.querySelectorAll('.subject-entry').forEach((entry) => {
            const index = entry.id.split('_[1]')[0];
            const baseSelector = document.getElementById(`base_${index}`);
            if (baseSelector) {
                baseSelector.value = newBase;
            }
        });
    }

    function createExamFields() {
        const numWeeks = parseInt(document.getElementById('numWeeks').value) || 1;
        const container = document.getElementById('examFieldsContainer');
        container.innerHTML = `<h3>Û±.Û². ØªÙ†Ø¸ÛŒÙ… Ø¢Ø²Ù…ÙˆÙ† Ùˆ Ù…Ø±ÙˆØ± Ù‡ÙØªÚ¯ÛŒ (Ø¨Ø±Ø§ÛŒ ${numWeeks} Ù‡ÙØªÙ‡)</h3>`;
        const dayOptions = dayNames.map(day => `<option value="${day}">${day}</option>`).join('');

        for (let w = 0; w < numWeeks; w++) {
            const weekHtml = `
                <div style="display: flex; gap: 15px; margin-top: 10px; border-bottom: 1px dashed #eee; padding-bottom: 10px;">
                    <span style="font-weight: bold; min-width: 50px;">Ù‡ÙØªÙ‡ ${w + 1}:</span>
                    <div style="flex: 1;">
                        <label for="examDay_W${w}" style="margin-top: 0;">Ø±ÙˆØ² Ø¢Ø²Ù…ÙˆÙ† Ø¬Ø§Ù…Ø¹ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                        <select id="examDay_W${w}">
                            <option value="Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…">Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…</option>
                            ${dayOptions}
                        </select>
                    </div>
                    <div style="flex: 1;">
                        <label for="reviewDay_W${w}" style="margin-top: 0;">Ø±ÙˆØ² Ù…Ø±ÙˆØ± Ø¬Ø§Ù…Ø¹ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
                        <select id="reviewDay_W${w}">
                            <option value="Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…">Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…</option>
                            ${dayOptions}
                        </select>
                    </div>
                </div>
            `;
            container.insertAdjacentHTML('beforeend', weekHtml);
        }
    }


    // --- ØªØ§Ø¨Ø¹ Ø¬Ù…Ø¹â€ŒØ¢ÙˆØ±ÛŒ ØªÙ…Ø§Ù… ØªÙ†Ø¸ÛŒÙ…Ø§Øª ---
    function getAllSettings() {
        const settings = {
            general: {
                base: document.getElementById('educationBase').value,
                numWeeks: document.getElementById('numWeeks').value,
                startDate: document.getElementById('startDate').value,
                testsPerPart: document.getElementById('testsPerPartGlobal').value,
                studentName: document.getElementById('studentName').value,
                consultantName: document.getElementById('consultantName').value,
                consultantNotes: document.getElementById('consultantNotes').value 
            },
            partsPerDay: dayNames.map((_, i) => parseInt(document.getElementById(`parts_${i}`).value) || 0),
            examDays: [],
            reviewDays: [], 
            subjects: []
        };
        
        const numWeeks = parseInt(settings.general.numWeeks) || 1;
        for (let w = 0; w < numWeeks; w++) {
            const examDaySelector = document.getElementById(`examDay_W${w}`);
            settings.examDays.push(examDaySelector ? examDaySelector.value : "Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…");
            
            const reviewDaySelector = document.getElementById(`reviewDay_W${w}`);
            settings.reviewDays.push(reviewDaySelector ? reviewDaySelector.value : "Ù‡ÛŒÚ†Ú©Ø¯Ø§Ù…");
        }

        document.querySelectorAll('.subject-entry').forEach((entry, i) => {
            const index = entry.id.split('_')[1];
            
            const nameEl = document.getElementById(`name_${index}`);
            const topicNameEl = document.getElementById(`topicName_${index}`);
            const baseEl = document.getElementById(`base_${index}`);
            const testsEl = document.getElementById(`tests_${index}`);
            const learnPartsEl = document.getElementById(`learnParts_${index}`);
            const sourceEl = document.getElementById(`source_${index}`);
            const classPartCountEl = document.getElementById(`classPartCount_${index}`);

            if (!nameEl) return; 

            const classDays = dayNames.filter((_, dIndex) => {
                const cb = document.getElementById(`classDay_${index}_${dIndex}`);
                return cb && cb.checked;
            });
            
            const forcedDays = dayNames.filter((_, dIndex) => {
                const cb = document.getElementById(`forcedDay_${index}_${dIndex}`);
                return cb && cb.checked;
            });
            
            settings.subjects.push({
                name: nameEl.value,
                topicName: topicNameEl ? topicNameEl.value : '',
                base: baseEl ? baseEl.value : '12',
                totalTests: testsEl ? parseInt(testsEl.value) : 0,
                totalLearnParts: learnPartsEl ? parseInt(learnPartsEl.value) : 0,
                source: sourceEl ? sourceEl.value : '',
                forcedDays: forcedDays, 
                classDays: classDays,
                classPartCount: classPartCountEl ? parseInt(classPartCountEl.value) : 0
            });
        });
        return settings;
    }

    
    // --- Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ ØµÙØ­Ù‡ ---
    document.addEventListener('DOMContentLoaded', () => {
        
        const dayPartsContainer = document.getElementById('dayPartsContainer');
        dayNames.forEach((day, i) => {
            const defaultValue = isSchoolDay(i) ? 4 : 6; 
            const html = `
                <div style="flex: 1; min-width: 150px;">
                    <label for="parts_${i}" style="margin-top: 0;">${day}:</label>
                    <input type="number" id="parts_${i}" value="${defaultValue}" min="0" max="10">
                </div>
            `;
            dayPartsContainer.insertAdjacentHTML('beforeend', html);
        });

        if (subjectCount === 0) {
             const defaultBaseValue = document.getElementById('educationBase').value;
             defaultSubjects.forEach(data => addSubjectEntry({...data, base: defaultBaseValue}));
        }

        const today = new Date();
        const nextSaturday = new Date(today);
        nextSaturday.setDate(today.getDate() + (6 - today.getDay() + 7) % 7); 
        document.getElementById('startDate').value = nextSaturday.toISOString().split('T')[0];
        
        createExamFields();

    });
</script>

</body>
</html>